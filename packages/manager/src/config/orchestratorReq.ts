import axios, { AxiosError } from 'axios';
import Router from 'next/router';
import { env } from './env';

export const orchestratorReq = axios.create({
  baseURL: env.PUBLIC_SPASHIP_ORCHESTRATOR_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
    Accept: 'application/json',
    rejectUnauthorized: 'false'
  }
});

export const setOrchestratorAuthorizationHeader = (token: string) => {
  orchestratorReq.defaults.headers.common.Authorization = `Bearer ${token}`;
  // orchestratorReq.defaults.headers.common.Authorization =
  // 'Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJFV1Vfby1pZlhnN0lKUXd5aGI4cnk2V2tBdjVtbVJwYWd5T2NLMzUzSWxBIn0.eyJleHAiOjE2Nzc3NTcyOTgsImlhdCI6MTY3Nzc1NTQ5OCwiYXV0aF90aW1lIjoxNjc3NzMzNjA5LCJqdGkiOiI5MGM4NWE2NC05MWRiLTRlNGItOTQ5MC1kNjQ1MzRiYTNiMTgiLCJpc3MiOiJodHRwczovL2F1dGguc3RhZ2UucmVkaGF0LmNvbS9hdXRoL3JlYWxtcy9FbXBsb3llZUlEUCIsImF1ZCI6InNwYXNoaXAtcmVmZXJlbmNlIiwic3ViIjoiNDE2NGU4OTMtYThhMy00MzM2LTkxOWUtMmU1MDJiYWI4NDE1IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoic3Bhc2hpcC1yZWZlcmVuY2UiLCJzZXNzaW9uX3N0YXRlIjoiYjEwYmRmOGMtMDFlYS00MWU4LThiYTEtYjEyMDIwYzVjMGQ3IiwiYWNyIjoiMCIsImFsbG93ZWQtb3JpZ2lucyI6WyJodHRwczovL3ByZXZpZXcuc3Bhc2hpcC5hcHBzLmludC5zcG9rZS5wcm9kLnVzLXdlc3QtMi5hd3MucGFhcy5yZWRoYXQuY29tIiwiaHR0cHM6Ly9xYS5zcGFzaGlwLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwOi8vbG9jYWxob3N0OjI0NjgiLCJodHRwczovL21hbmFnZXItcm91dGUuYXBwcy5ncmV5LmRldi5pYWQyLmRjLnBhYXMucmVkaGF0LmNvbSIsImh0dHBzOi8vZGV2LmZvby5yZWRoYXQuY29tOjI0NjgiLCJodHRwOi8vZGV2Lm9uZS1yZWRoYXQtY29tLmRldi5hcHBzLmludC5zcG9rZS5wcmVwcm9kLnVzLXdlc3QtMi5hd3MucGFhcy5yZWRoYXQuY29tIiwiaHR0cHM6Ly9kZXYuc3Bhc2hpcC5hcHBzLmludC5zcG9rZS5wcmVwcm9kLnVzLXdlc3QtMi5hd3MucGFhcy5yZWRoYXQuY29tIiwiaHR0cHM6Ly9tYW5hZ2VyLXJvdXRlLmFwcHMuaW50Lm1wcC5wcm9kLmlhZDIuZGMucGFhcy5yZWRoYXQuY29tIiwiaHR0cHM6Ly9zcGFzaGlwLnByZXByb2Qub25lLnJlZGhhdC5jb20iLCJodHRwOi8vcWEub25lLXJlZGhhdC1jb20uZGV2LmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwOi8vc3Bhc2hpcC5wcmVwcm9kLnJlZGhhdC5jb20iLCJodHRwczovL3NwYXNoaXAuZGV2LnJlZGhhdC5jb20iLCJodHRwOi8vZGV2Lm9uZS1yZWRoYXQtY29tLnFhLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwOi8vZGV2Lm9uZS1yZWRoYXQtY29tLnN0YWdlLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwOi8vc3RhZ2Uub25lLXJlZGhhdC1jb20uZGV2LmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtZWFzdC0xLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwczovL21hbmFnZXItcm91dGUtbmV3LmFwcHMuZ3JleS5kZXYuaWFkMi5kYy5wYWFzLnJlZGhhdC5jb20iLCJodHRwczovL3NwYXNoaXAucHJlcHJvZC5yZWRoYXQuY29tIiwiaHR0cDovL3FhLm9uZS1yZWRoYXQtY29tLnFhLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwczovL3NwYXNoaXAudXNlcnN5cy5yZWRoYXQuY29tIiwiaHR0cDovL3N0YWdlLm9uZS1yZWRoYXQtY29tLnN0YWdlLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtZWFzdC0xLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwOi8vc3RhZ2Uub25lLXJlZGhhdC1jb20ucWEuYXBwcy5pbnQuc3Bva2UucHJlcHJvZC51cy1lYXN0LTEuYXdzLnBhYXMucmVkaGF0LmNvbSIsImh0dHBzOi8vc3Bhc2hpcC5zdGFnZS5yZWRoYXQuY29tIiwiaHR0cDovL2Rldi5mb28ucmVkaGF0LmNvbToyNDY4IiwiaHR0cDovL2Rldi5vbmUtcmVkaGF0LWNvbS5wcm9kLmFwcHMuaW50LnNwb2tlLnByZXByb2QudXMtd2VzdC0yLmF3cy5wYWFzLnJlZGhhdC5jb20iLCJodHRwczovL3NwYXNoaXAudGVzdC51c2Vyc3lzLnJlZGhhdC5jb20iLCJodHRwczovL3NwYXNoaXAucWEucmVkaGF0LmNvbSIsImh0dHBzOi8vbWFuYWdlci1yb3V0ZS5hcHBzLmludC5tcHAucHJlcHJvZC5pYWQyLmRjLnBhYXMucmVkaGF0LmNvbSIsImh0dHBzOi8vcWEub25lLXJlZGhhdC1jb20uc3RhZ2UuYXBwcy5pbnQuc3Bva2UucHJlcHJvZC51cy13ZXN0LTIuYXdzLnBhYXMucmVkaGF0LmNvbSIsImh0dHA6Ly9xYS5vbmUtcmVkaGF0LWNvbS5zdGFnZS5hcHBzLmludC5zcG9rZS5wcmVwcm9kLnVzLXdlc3QtMi5hd3MucGFhcy5yZWRoYXQuY29tIiwiaHR0cDovL3FhLm9uZS1yZWRoYXQtY29tLnByb2QuYXBwcy5pbnQuc3Bva2UucHJlcHJvZC51cy13ZXN0LTIuYXdzLnBhYXMucmVkaGF0LmNvbSIsImh0dHBzOi8vc3RhZ2Uuc3Bhc2hpcC5hcHBzLmludC5zcG9rZS5wcmVwcm9kLnVzLWVhc3QtMS5hd3MucGFhcy5yZWRoYXQuY29tIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6MjQ2OCJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidGVzdC1ncm91cC1uby1tZW1iZXJzIiwib25lLXBvcnRhbC1kZXZlbCIsIm9mZmxpbmVfYWNjZXNzIiwib25lLXBsYXRmb3JtLWRldnMiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJtYW5hZ2UtYWNjb3VudC1saW5rcyIsInZpZXctcHJvZmlsZSJdfX0sInNjb3BlIjoic2xpbV9vaWRjIiwiZmlyc3ROYW1lIjoiTmlraGl0YSIsImxhc3ROYW1lIjoiTW9yZSIsImVtcGxveWVlVHlwZSI6IkVtcGxveWVlIiwicm9sZSI6WyJ0ZXN0LWdyb3VwLW5vLW1lbWJlcnMiLCJvbmUtcG9ydGFsLWRldmVsIiwib2ZmbGluZV9hY2Nlc3MiLCJvbmUtcGxhdGZvcm0tZGV2cyIsInVtYV9hdXRob3JpemF0aW9uIl0sIm5hbWUiOiJOaWtoaXRhIE1vcmUiLCJyaGF0VVVJRCI6IjUyZWNlM2MwLTg3YWEtMTFlZC1iYWM4LTBhNThhYzE0YjcwYyIsInByZWZlcnJlZF91c2VybmFtZSI6Im5tb3JlIiwiZW1haWwiOiJubW9yZUByZWRoYXQuY29tIiwiZW1wbG95ZWVOdW1iZXIiOiIxNjAxNDAyOCJ9.ZwwuDIuVaRBHPwH_z2X2H0sXrmkQE6SL9R4ZZCdCiaiUprv2vCWbCEL7mZpGp3_1P-8D2AjnJh7GnBJBra69liImfJ3_QaZS-AvWre4uoNA8GNvZ_ayx-AnYRiBi3qpqFnp1XL-z3YBCECSK3_DMW64Xc36i7kUdCaKUoMFa-HVgNNXeHlSYHp_0nF3t7CHhEU6RZtiegKVvbrcbq1E1uiMYHw62Sg-WB7lB-plhdLAROipdEC11vEjYYuYbnyeQfGyujuUdfntzRWO790rPdyhLXDREmIm9U6THNAqS0HCGPfIA3c3hBLFrrzjfWIRRx9FDaTKMA5meFV2B1wzYRh8eGbaT4qM6Ixgp_aZneAjTynN17MnDD_G0mzRWJEYiGUoeZthfqT9fYhWnF5R8GIUyF4ditqdx3xWpgJmk9xaqm8LWJ9gaBURq3dyw-JICaOYc2grxoHdfnC5LQ7q82jrtHFbNdpaUb0Fr6FBqP1F8D_8LKMUG_t4UQviQiwZOh7Lgu5UjXKioi5YUfTdrKMaP_h8H2JrdsaJLkYr0Gv3FF1jNEKDn-GBljDwDkyOkm9VsFVbGBGWkhVPLfG26ZXPXrsixNhjF1yAL1HMWNc1YBIE-4TMONldgcCZ25s1T16mW5fucL0banwgwPTQ53yzECaJ3TDZ2eJaoyaD7BZw';
};

orchestratorReq.interceptors.response.use(
  (response) => response,
  (error: AxiosError) => {
    if (error.response && error.response.status === 401) {
      delete orchestratorReq.defaults.headers.common.Authorization;
      return Router.push('/login');
    }
    return Promise.reject(error);
  }
);

// Global error handler for axios requests
orchestratorReq.interceptors.response.use(
  (response) => response,
  (error) => {
    console.error('Error:', error);
    return Promise.reject(error);
  }
);
